<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Vacation Booking</title>


  <!-- Include Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <!-- Include Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet" />
  {{!--
  <link rel="stylesheet" href="/css/index.css"> --}}


</head>

<body>
  <div class="main-container">


    <nav class="bg-gray-900 text-white w-screen shadow-lg shadow-gray-500/50">
      <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">

        <a href="/" class="flex items-center">
          <img src="/assets/icon1.png" class="h-10 w-10 mr-3" alt="Flowbite Logo" />
          <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Vacay Booking </span>
        </a>

        <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="mobile-menu-2">
          <ul
            class="flex flex-col text-white font-medium p-4 md:p-0 mt-4 border border-gray-900 rounded-lg bg-gray-900 md:flex-row md:space-x-8 md:mt-0 md:border-0  dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
            <li>
              <a href="/"
                class="block py-2 pl-3 pr-4 text-white-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-400 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
                aria-current="page">Home</a>
            </li>
            <li>
              <a href="/flights"
                class="block py-2 pl-3 pr-4 text-white-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-400 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Flights</a>
            </li>
            <li>
              <a href="/hotels"
                class="block py-2 pl-3 pr-4 text-white-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-400 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Hotels</a>
            </li>
            <li>
              <a href="/restaurants" 
                class="block py-2 pl-3 pr-4 text-white-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-400 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Restaurants</a>
            </li>
          </ul>
        </div>


        {{#if user_session_data }}

        <div class="flex items-center md:order-2">
          <button type="button"
            class="flex mr-3 text-sm rounded md:mr-0 focus:bg-gray-600"
            id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown"
            data-dropdown-placement="bottom">
            <span class="sr-only">Open user menu</span>
            <img class="w-9 h-9 rounded-full" src="/assets/hilton.jpg" alt="user photo">
            <h1 class="p-2 text-bold">Welcome {{user_name user_session_data.email}}!</h1>
          </button>
          <!-- Dropdown menu -->
          <div
            class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600"
            id="user-dropdown">
            <div class="px-4 py-3">
              <span class="block text-sm  text-gray-500 truncate dark:text-gray-400">{{user_session_data.email}}</span>
            </div>
            <ul class="py-2" aria-labelledby="user-menu-button">
              <li>
                <a href="/"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Home</a>
              </li>
              <li>
                <a href="/dashboard"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Dashboard</a>
              </li>
              <li>
                <a href="/signout"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white signoutBtn">Signout</a>
              </li>
              <li>
                {{!-- <a href="/login"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Login</a>
              </li> --}}
            </ul>
          </div>



          <button data-collapse-toggle="mobile-menu-2" type="button"
            class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
            aria-controls="mobile-menu-2" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd"
                d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                clip-rule="evenodd"></path>
            </svg>
          </button>

        </div>

        {{else}}
        <div class="flex items-center md:order-2">
          <a href="/login"
            class="text-white bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 shadow-lg shadow-blue-500/50 dark:shadow-lg dark:shadow-blue-800/80 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2">Login</a>
        </div>
        {{/if}}
      </div>
    </nav>


    {{!-- <!-- ----------------NAV END --------------- --> --}}





    <div id="page-wrapper" class="container" class="m-5">
      <main>
        {{{ body }}}
      </main>
    </div>


    {{#if loggedIn}}
    <script src="/js/logout.js"></script>
    {{/if}}


{{>chat}}
    


<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>
</body>
{{!--
<script src="/javascript/hotel.js"></script> --}}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
  // Initialize Flatpickr
  flatpickr('#dateRange', {
    mode: 'range',
    dateFormat: 'Y-m-d',
    // You can customize more options as per your requirements
  });


  const signoutBtnEle = document.querySelector('.signoutBtn')

  function signout() {
    fetch('/api/users/logout', {
      method: "POST",
    }).then((logoutData) => {
      console.log("USER logged out")
      document.location.reload()
    }).catch((err) => {
      console.log(err)
    })
  }
  signoutBtnEle.addEventListener('click', signout)


</script>



<script type="application/javascript" src="/socket.io/socket.io.js" ></script>


<script>
	let socket = io();

	let form = document.getElementById('form');
  {{!-- let myname = "{{user_session_data.email}}" --}}
  let myname = "{{user_name user_session_data.email}}"
	let message = document.getElementById('message');
	let messageArea = document.getElementById("messageArea");
  let chatlabelEle = document.querySelector('.chat-label')

	form.addEventListener("submit", (e) => {
		e.preventDefault();

		if (message.value) {
			socket.emit('send message', {userName: myname, chatMsg: message.value});
			message.value = "";
		}
	});

	socket.on("send message", (data) => {
    let chatWrapper = document.createElement('div')
    chatWrapper.className +="flex px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 chat-main"

    let chatSubWrapper = document.createElement('div')
    chatSubWrapper.className +="w-full pl-3 msg-submain"

    console.log("myname: ",myname,"userName: ",data.userName)

    let chatdiv = document.createElement('div')

    if(data.userName != myname){
      chatdiv.className +="text-gray-500 text-sm mb-1.5 dark:text-gray-400 bg-gradient-to-r from-cyan-200 via-cyan-250 to-cyan-300 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-cyan-300 dark:focus:ring-cyan-800 shadow-lg shadow-cyan-500/50 dark:shadow-lg dark:shadow-cyan-800/80 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 w-1/2"
    }else{
      chatdiv.className +="text-gray-500 text-sm mb-1.5 dark:text-gray-400 bg-gradient-to-r from-lime-200 via-lime-250 to-lime-300 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 dark:focus:ring-lime-800 shadow-lg shadow-lime-500/50 dark:shadow-lg dark:shadow-lime-800/80 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 text-right w-1/2 float-right"
    }


    let label = document.createElement("span")
    label.className +="font-semibold text-gray-900 dark:text-white chat-label"
    label.textContent = data.userName

		let chatContent = document.createElement("div");
		chatContent.textContent = data.chatMsg;

		chatdiv.appendChild(label);
    chatdiv.appendChild(chatContent);

    chatSubWrapper.appendChild(chatdiv)

    chatWrapper.appendChild(chatSubWrapper)

    messageArea.appendChild(chatWrapper)
	});



</script>



</html>